<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Wyszukaj Przesy≈Çkƒô</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="page">
  <header class="topbar">
    <a href="index.html" class="logo">
      <div class="logo-icon">üì¶</div>
      <span>Salfetka</span>
    </a>
    <nav class="topbar-nav">
      <a class="link-btn" href="login.html">Log In</a>
    </nav>
  </header>

  <main class="panel">
    <h1 class="panel-title">Wyszukaj Przesy≈Çkƒô</h1>
    
    <form id="searchForm" class="form-narrow centered" autocomplete="off">
      <div class="form-group">
        <label for="trackingNumber">Numer przesy≈Çki</label>
        <div class="input-wrapper">
          <div class="input-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </div>
          <input id="trackingNumber" class="input has-icon" type="text" placeholder="Wpisz numer przesy≈Çki" required>
          <div class="error-message" id="trackingError"></div>
        </div>
      </div>
      
      <button class="btn-primary" type="submit" style="margin: 0 auto; display: block;">Szukaj</button>
    </form>

    <div id="searchResult" style="max-width: 600px; margin: 24px auto; display: none;">
      <div id="resultContent" style="width: 100%; background: #f5f5f5; padding: 24px; border-radius: 8px;"></div>
    </div>

    <div class="centered" style="margin: 40px auto 0; max-width: 700px; gap: 20px;">
      <section style="text-align: center; width: 100%;">
        <h2 style="margin-bottom: 16px; font-size: 20px;">Jak ≈õledziƒá przesy≈Çkƒô?</h2>
        <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: nowrap;">
          <div style="padding: 16px; background: #f9f9f9; border-radius: 8px; flex: 1; text-align: center; min-width: 0;">
            <div style="font-size: 32px; margin-bottom: 8px;">1Ô∏è‚É£</div>
            <strong>Wpisz numer</strong>
            <p style="font-size: 14px; margin-top: 8px; color: #666;">Wprowad≈∫ numer przesy≈Çki w pole powy≈ºej</p>
          </div>
          <div style="padding: 16px; background: #f9f9f9; border-radius: 8px; flex: 1; text-align: center; min-width: 0;">
            <div style="font-size: 32px; margin-bottom: 8px;">2Ô∏è‚É£</div>
            <strong>Sprawd≈∫ status</strong>
            <p style="font-size: 14px; margin-top: 8px; color: #666;">Zobacz aktualny status i lokalizacjƒô</p>
          </div>
          <div style="padding: 16px; background: #f9f9f9; border-radius: 8px; flex: 1; text-align: center; min-width: 0;">
            <div style="font-size: 32px; margin-bottom: 8px;">3Ô∏è‚É£</div>
            <strong>Otrzymaj powiadomienia</strong>
            <p style="font-size: 14px; margin-top: 8px; color: #666;">Zaloguj siƒô, aby otrzymywaƒá aktualizacje</p>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="page-footer">
    <nav class="footer-nav">
      <a class="link-btn" href="about.html">O nas</a>
      <a class="link-btn" href="contact.html">Kontakt</a>
    </nav>
  </footer>
</div>

<script>
  const searchForm = document.getElementById('searchForm');
  const searchResult = document.getElementById('searchResult');
  const resultContent = document.getElementById('resultContent');

  // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  const sampleShipments = [
    { 
      id: 'MFINBDJK87', 
      status: 'W drodze', 
      date: '2025-10-24', 
      destination: 'Katowice',
      history: [
        { date: '2025-10-24 08:30', status: 'W drodze', location: 'Warszawa' },
        { date: '2025-10-23 14:20', status: 'Wys≈Çana', location: 'Warszawa' },
        { date: '2025-10-23 10:15', status: 'Przyjƒôta', location: 'Warszawa' }
      ]
    },
    { 
      id: 'AMSDNA1192', 
      status: 'Dostarczona', 
      date: '2025-10-20', 
      destination: 'Pozna≈Ñ',
      history: [
        { date: '2025-10-20 16:45', status: 'Dostarczona', location: 'Pozna≈Ñ' },
        { date: '2025-10-20 09:00', status: 'W drodze', location: 'Pozna≈Ñ' },
        { date: '2025-10-19 15:30', status: 'Wys≈Çana', location: 'Warszawa' }
      ]
    },
    { 
      id: 'HDJALAMA78', 
      status: 'Magazyn', 
      date: '2025-10-23', 
      destination: 'Gda≈Ñsk',
      history: [
        { date: '2025-10-23 11:00', status: 'Magazyn', location: 'Gda≈Ñsk' },
        { date: '2025-10-22 18:20', status: 'Przyjƒôta', location: 'Warszawa' }
      ]
    },
    { 
      id: 'HSKNBDJK87', 
      status: 'Utworzona', 
      date: '2025-10-19', 
      destination: 'Wroc≈Çaw',
      history: [
        { date: '2025-10-19 12:00', status: 'Utworzona', location: 'Warszawa' }
      ]
    },
    { 
      id: 'HKBYHSK227', 
      status: 'Gotowa do wysy≈Çki', 
      date: '2025-10-21', 
      destination: 'Warszawa',
      history: [
        { date: '2025-10-21 10:30', status: 'Gotowa do wysy≈Çki', location: 'Warszawa' },
        { date: '2025-10-21 08:00', status: 'Przyjƒôta', location: 'Warszawa' }
      ]
    }
  ];

  searchForm.addEventListener('submit', function(e){
    e.preventDefault();
    const trackingInput = document.getElementById('trackingNumber');
    const trackingError = document.getElementById('trackingError');
    const trackingNumber = trackingInput.value.trim();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    trackingInput.classList.remove('error');
    trackingError.classList.remove('show');
    trackingError.textContent = '';
    
    if(!trackingNumber){
      trackingInput.classList.add('error');
      trackingError.textContent = 'Wpisz numer przesy≈Çki.';
      trackingError.classList.add('show');
      return;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ –±–µ–π–¥–∂–∞ —Å—Ç–∞—Ç—É—Å–∞
    function getStatusBadgeClass(status) {
      const statusMap = {
        'Utworzona': 'utworzona',
        'W drodze': 'w-drodze',
        'Dostarczona': 'dostarczona',
        'Wydana klientowi': 'wydana-klientowi',
        'Otrzymana': 'otrzymana',
        'Przyjƒôta': 'przyjeta',
        'Magazyn': 'magazyn',
        'Gotowa do wysy≈Çki': 'gotowa-do-wysylki',
        'Wys≈Çana': 'wyslana',
        'Anulowana': 'anulowana'
      };
      return statusMap[status] || 'utworzona';
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    resultContent.innerHTML = `
      <div style="text-align: center; padding: 20px;">
        <div style="font-size: 48px; margin-bottom: 16px;">‚è≥</div>
        <p>Szukanie przesy≈Çki...</p>
      </div>
    `;
    searchResult.style.display = 'block';

    // –ó–∞–ø—Ä–æ—Å –∫ API
    fetch(`/backend/parcel_search.php?number=${encodeURIComponent(trackingNumber)}`)
      .then(response => {
        if (!response.ok) {
          return response.json().then(data => {
            throw new Error(data.error || 'B≈ÇƒÖd serwera');
          });
        }
        return response.json();
      })
      .then(shipment => {
        // –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é
        let historyHtml = '';
        if (shipment.history && shipment.history.length > 0) {
          historyHtml = '<div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;"><strong>Historia przesy≈Çki:</strong><ul style="margin-top: 12px; padding-left: 20px;">';
          shipment.history.forEach(h => {
            historyHtml += `<li style="margin-bottom: 8px; line-height: 1.6;"><strong>${h.date}</strong> - <span class="status-badge ${getStatusBadgeClass(h.status)}">${h.status}</span> (${h.location})</li>`;
          });
          historyHtml += '</ul></div>';
        }
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª–∏
        let detailsHtml = '';
        if (shipment.details) {
          detailsHtml = '<div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e0e0e0;">';
          if (shipment.details.sender_name) {
            detailsHtml += `<p><strong>Odbiorca:</strong> ${shipment.details.sender_name}</p>`;
          }
          if (shipment.details.description) {
            detailsHtml += `<p><strong>Opis:</strong> ${shipment.details.description}</p>`;
          }
          if (shipment.details.size) {
            detailsHtml += `<p><strong>Rozmiar:</strong> ${shipment.details.size}</p>`;
          }
          if (shipment.details.weight) {
            detailsHtml += `<p><strong>Waga:</strong> ${shipment.details.weight}</p>`;
          }
          if (shipment.details.price) {
            detailsHtml += `<p><strong>Cena:</strong> ${shipment.details.price} PLN</p>`;
          }
          detailsHtml += '</div>';
        }
        
        resultContent.innerHTML = `
          <h3 style="margin-top: 0; margin-bottom: 16px; text-align: left;">Numer przesy≈Çki: <strong style="font-size: 20px;">${shipment.id}</strong></h3>
          <div style="margin-bottom: 16px; text-align: left;">
            <span class="status-badge ${getStatusBadgeClass(shipment.status)}">${shipment.status}</span>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
            <p><strong>Data utworzenia:</strong><br>${shipment.date.split('-').reverse().join('-')}</p>
            <p><strong>Adres odbiorcy:</strong><br>${shipment.destination}</p>
          </div>
          ${detailsHtml}
          ${historyHtml}
          <div style="margin-top: 20px; text-align: center;">
            <a href="login.html" class="link-btn" style="text-decoration: none; display: inline-block;">Zaloguj siƒô, aby otrzymywaƒá powiadomienia</a>
          </div>
        `;
      })
      .catch(error => {
        resultContent.innerHTML = `
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üì¶</div>
            <p style="color: #d32f2f; margin: 0; font-size: 18px;"><strong>Nie znaleziono przesy≈Çki</strong></p>
            <p style="margin-top: 12px; margin-bottom: 8px;">Numer: <strong>${trackingNumber}</strong></p>
            <p style="margin-top: 12px; margin-bottom: 0; color: #666;">${error.message || 'Sprawd≈∫ numer przesy≈Çki i spr√≥buj ponownie. Je≈õli problem siƒô powtarza, <a href="contact.html" style="color: #6f3b39;">skontaktuj siƒô z nami</a>.'}</p>
          </div>
        `;
      });
  });
</script>
</body>
</html>
