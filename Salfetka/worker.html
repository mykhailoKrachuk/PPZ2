<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Strona Pracownika</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="page worker-page">
  <header class="topbar">
    <a href="index.html" class="logo">
      <div class="logo-icon">üì¶</div>
      <span>Salfetka</span>
    </a>
    <nav class="topbar-nav">
      <a class="link-btn" href="index.html">Wyszukaj przesy≈Çkƒô</a>
      <a class="link-btn" href="login.html">Wy≈Çoguj siƒô</a>
    </nav>
  </header>

  <main class="worker-panel">
    <section class="worker-search">
      <h1 class="section-title">Strona Pracownika</h1>
      <div class="form-group">
        <label for="searchNumber">Numer przesy≈Çki</label>
        <input id="searchNumber" class="worker-input" type="text" placeholder="Wpisz numer">
      </div>

      <div class="form-group">
        <label for="searchFirst">Imiƒô</label>
        <input id="searchFirst" class="worker-input" type="text" placeholder="Wpisz imiƒô">
      </div>

      <div class="form-group">
        <label for="searchLast">Nazwisko</label>
        <input id="searchLast" class="worker-input" type="text" placeholder="Wpisz nazwisko">
      </div>

      <button id="createBtn" class="worker-btn full" type="button">Utw√≥rz</button>
    </section>

    <section class="worker-results">
      <h2 class="section-title">Lista przesy≈Çek</h2>
      <div class="worker-controls">
        <div class="form-group" style="margin-bottom: 0;">
          <label for="destinationSelect">Miasto docelowe</label>
          <select id="destinationSelect" class="worker-input select">
            <option value="">Wszystkie miasta</option>
            <option value="Katowice">Katowice</option>
            <option value="Pozna≈Ñ">Pozna≈Ñ</option>
            <option value="Gda≈Ñsk">Gda≈Ñsk</option>
            <option value="Wroc≈Çaw">Wroc≈Çaw</option>
            <option value="Warszawa">Warszawa</option>
          </select>
        </div>
        <button id="detailsBtn" class="worker-btn" type="button" style="align-self: flex-end;">Wy≈õwietl</button>
      </div>

      <div id="workerList" class="worker-list"></div>
    </section>
  </main>
</div>

<div id="createOverlay" class="modal-overlay hidden" aria-hidden="true">
  <div class="modal-card worker-modal" role="dialog" aria-modal="true" aria-labelledby="createHeading">
    <button class="close-btn" type="button" data-close="createOverlay" aria-label="Zamknij okno">&times;</button>
    <h2 id="createHeading">Tworzenie Przesy≈Çki</h2>
    <form id="createForm" class="modal-form">
      <div class="form-group">
        <label for="receiverName" class="required">Imiƒô i nazwisko odbiorcy</label>
        <input id="receiverName" type="text" required>
      </div>

      <div class="form-group">
        <label for="receiverAddress" class="required">Adres Dostawy</label>
        <input id="receiverAddress" type="text" required>
      </div>

      <div class="form-group">
        <label for="receiverPhone" class="required">Numer Telefonu</label>
        <input id="receiverPhone" type="tel" required>
      </div>

      <div class="form-group">
        <label for="packageNote">Opis</label>
        <textarea id="packageNote" rows="2"></textarea>
      </div>

      <button class="worker-btn full" type="submit">Utw√≥rz</button>
    </form>
  </div>
</div>

<div id="issueOverlay" class="modal-overlay hidden" aria-hidden="true">
  <div class="modal-card worker-modal" role="dialog" aria-modal="true" aria-labelledby="issueHeading">
    <button class="close-btn" type="button" data-close="issueOverlay" aria-label="Zamknij okno">&times;</button>
    <h2 id="issueHeading">Informacje o przesy≈Çce</h2>
    <p id="issueCode" class="details-code">Wybierz przesy≈Çkƒô</p>
    <p id="issueStatus"></p>
    <p id="issueDate"></p>
    <div id="codeInputContainer" class="form-group hidden">
      <label for="nadaniaCode">Kod nadania</label>
      <input id="nadaniaCode" type="text" placeholder="Wpisz kod nadania" class="input">
    </div>
    <button id="issueBtn" class="worker-btn full" type="button">wydaj</button>
  </div>
</div>

<div id="successOverlay" class="modal-overlay hidden" aria-hidden="true">
  <div class="modal-card worker-modal" role="dialog" aria-modal="true">
    <button class="close-btn" type="button" data-close="successOverlay" aria-label="Zamknij okno">&times;</button>
    <div class="success-message">
      <div class="success-icon">‚úì</div>
      <h3>Przesy≈Çka wydana</h3>
      <p>Na Tw√≥j email zosta≈Ç wys≈Çany kod.</p>
      <button class="worker-btn full" type="button" data-close="successOverlay">OK</button>
    </div>
  </div>
</div>

<script>
  const shipments = [
    { id:'MFINBDJK87', destination:'Katowice', status:'Utworzona', date:'2025-10-24', receiverFirst:'Anna', receiverLast:'Nowak', address:'ul. Le≈õna 10, Katowice', phone:'+48 500 200 111', note:'Pilne' },
    { id:'AMSDNA1192', destination:'Pozna≈Ñ', status:'W drodze', date:'2025-10-20', receiverFirst:'Marek', receiverLast:'Kowalski', address:'ul. Wi≈õlana 3, Pozna≈Ñ', phone:'+48 501 111 222', note:'' },
    { id:'HDJALAMA78', destination:'Gda≈Ñsk', status:'Otrzymana', date:'2025-10-23', receiverFirst:'Julia', receiverLast:'Mazur', address:'ul. Morska 7, Gda≈Ñsk', phone:'+48 502 333 444', note:'Delikatna zawarto≈õƒá' },
    { id:'HSKNBDJK87', destination:'Wroc≈Çaw', status:'Magazyn', date:'2025-10-19', receiverFirst:'Kamil', receiverLast:'Pola≈Ñski', address:'ul. Lipowa 17, Wroc≈Çaw', phone:'+48 503 555 666', note:'' },
    { id:'HKBYHSK227', destination:'Warszawa', status:'Gotowa do wysy≈Çki', date:'2025-10-21', receiverFirst:'Olga', receiverLast:'Zieli≈Ñska', address:'ul. D≈Çuga 4, Warszawa', phone:'+48 504 777 888', note:'Odbi√≥r osobisty' }
  ];

  const filters = { number:'', first:'', last:'', destination:'' };
  let selectedId = '';

  const listEl = document.getElementById('workerList');
  const destinationSelect = document.getElementById('destinationSelect');
  const detailsBtn = document.getElementById('detailsBtn');
  const createBtn = document.getElementById('createBtn');
  const createOverlay = document.getElementById('createOverlay');
  const issueOverlay = document.getElementById('issueOverlay');
  const createForm = document.getElementById('createForm');
  const issueBtn = document.getElementById('issueBtn');
  const issueCode = document.getElementById('issueCode');
  const issueStatus = document.getElementById('issueStatus');
  const issueDate = document.getElementById('issueDate');
  const codeInputContainer = document.getElementById('codeInputContainer');
  const nadaniaCodeInput = document.getElementById('nadaniaCode');
  const successOverlay = document.getElementById('successOverlay');

  document.getElementById('searchNumber').addEventListener('input', e => { filters.number = e.target.value.trim().toLowerCase(); renderList(); });
  document.getElementById('searchFirst').addEventListener('input', e => { filters.first = e.target.value.trim().toLowerCase(); renderList(); });
  document.getElementById('searchLast').addEventListener('input', e => { filters.last = e.target.value.trim().toLowerCase(); renderList(); });
  destinationSelect.addEventListener('change', e => { filters.destination = e.target.value; renderList(); });

  function matchesFilters(item){
    const numberOk = !filters.number || item.id.toLowerCase().includes(filters.number);
    const firstOk = !filters.first || item.receiverFirst.toLowerCase().includes(filters.first);
    const lastOk = !filters.last || item.receiverLast.toLowerCase().includes(filters.last);
    const destOk = !filters.destination || item.destination === filters.destination;
    return numberOk && firstOk && lastOk && destOk;
  }

  function renderList(){
    listEl.innerHTML = '';
    const filtered = shipments.filter(matchesFilters);
    if(!filtered.length){
      const empty = document.createElement('div');
      empty.className = 'empty';
      empty.innerHTML = `
        <div class="empty-icon">üì¶</div>
        <div class="empty-text">Brak przesy≈Çek do wy≈õwietlenia</div>
      `;
      listEl.appendChild(empty);
      selectedId = '';
      return;
    }
    filtered.forEach(item => {
      const btn = document.createElement('button');
      btn.className = 'worker-row';
      btn.type = 'button';
      btn.dataset.id = item.id;
      btn.innerHTML = `<span>${item.id}</span><strong>${item.destination.toLowerCase()}</strong>`;
      btn.addEventListener('click', () => selectShipment(item.id, btn));
      if(item.id === selectedId){
        btn.classList.add('active');
      }
      listEl.appendChild(btn);
    });
  }

  function selectShipment(id, button){
    selectedId = id;
    document.querySelectorAll('.worker-row').forEach(row => row.classList.remove('active'));
    button.classList.add('active');
  }

  function openOverlay(element){
    element.classList.remove('hidden');
    element.setAttribute('aria-hidden', 'false');
  }

  function closeOverlay(element){
    element.classList.add('hidden');
    element.setAttribute('aria-hidden', 'true');
  }

  createBtn.addEventListener('click', () => openOverlay(createOverlay));
  detailsBtn.addEventListener('click', () => {
    if(!selectedId){
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–º–µ—Å—Ç–æ alert
      const errorOverlay = document.createElement('div');
      errorOverlay.className = 'modal-overlay';
      errorOverlay.innerHTML = `
        <div class="modal-card worker-modal">
          <button class="close-btn" type="button" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <div class="success-message">
            <div class="success-icon" style="color: #ef4444;">!</div>
            <h3>B≈ÇƒÖd</h3>
            <p>Wybierz przesy≈Çkƒô z listy.</p>
            <button class="worker-btn full" type="button" onclick="this.closest('.modal-overlay').remove()">OK</button>
          </div>
        </div>
      `;
      document.body.appendChild(errorOverlay);
      return;
    }
    const shipment = shipments.find(item => item.id === selectedId);
    function getStatusBadgeClass(status) {
      const statusMap = {
        'Utworzona': 'utworzona',
        'W drodze': 'w-drodze',
        'Dostarczona': 'dostarczona',
        'Wydana klientowi': 'wydana-klientowi',
        'Przyjƒôta': 'przyjeta',
        'Otrzymana': 'dostarczona',
        'Magazyn': 'magazyn',
        'Gotowa do wysy≈Çki': 'gotowa-do-wysylki',
        'Wys≈Çana': 'wyslana'
      };
      return statusMap[status] || 'utworzona';
    }
    issueCode.textContent = shipment.id;
    issueStatus.innerHTML = 'Status: <span class="status-badge ' + getStatusBadgeClass(shipment.status) + '">' + shipment.status + '</span>';
    issueDate.textContent = 'Data wys≈Çania: ' + shipment.date.split('-').reverse().join('-');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –∫–æ–¥–∞ –Ω–∞–¥–∞–Ω–Ω—è, –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "Otrzymana" –∏–ª–∏ "Przyjƒôta"
    if(shipment.status === 'Otrzymana' || shipment.status === 'Przyjƒôta'){
      codeInputContainer.classList.remove('hidden');
      nadaniaCodeInput.value = '';
    } else {
      codeInputContainer.classList.add('hidden');
    }
    
    openOverlay(issueOverlay);
  });

  issueBtn.addEventListener('click', () => {
    if(!selectedId){ return; }
    const shipment = shipments.find(item => item.id === selectedId);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞–¥–∞–Ω–Ω—è, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è
    if(shipment.status === 'Otrzymana' || shipment.status === 'Przyjƒôta'){
      const code = nadaniaCodeInput.value.trim();
      if(!code){
        nadaniaCodeInput.classList.add('error');
        nadaniaCodeInput.focus();
        return;
      }
      nadaniaCodeInput.classList.remove('error');
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—ã–¥–∞—á–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
    closeOverlay(issueOverlay);
    openOverlay(successOverlay);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—Å—ã–ª–∫–∏
    shipment.status = 'Wydana';
  });

  createForm.addEventListener('submit', e => {
    e.preventDefault();
    const newShipment = {
      id: 'NP' + Math.random().toString(36).slice(2, 8).toUpperCase(),
      destination: filters.destination || 'Katowice',
      status: 'Utworzona',
      date: new Date().toISOString().split('T')[0],
      receiverFirst: document.getElementById('receiverName').value.split(' ')[0] || 'Nowy',
      receiverLast: document.getElementById('receiverName').value.split(' ')[1] || 'Klient',
      address: document.getElementById('receiverAddress').value,
      phone: document.getElementById('receiverPhone').value,
      note: document.getElementById('packageNote').value || ''
    };
    shipments.unshift(newShipment);
    e.target.reset();
    closeOverlay(createOverlay);
    renderList();
  });

  document.querySelectorAll('.modal-overlay').forEach(overlay => {
    overlay.addEventListener('click', e => {
      if(e.target === overlay){
        closeOverlay(overlay);
      }
    });
  });
  document.querySelectorAll('[data-close]').forEach(btn => {
    btn.addEventListener('click', () => {
      const target = document.getElementById(btn.dataset.close);
      if(target){ 
        closeOverlay(target);
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ —É—Å–ø–µ—Ö–∞
        if(target.id === 'successOverlay'){
          renderList();
        }
      }
    });
  });

  renderList();
</script>
</body>
</html>

